(function(e){function t(t){for(var s,r,o=t[0],c=t[1],u=t[2],d=0,v=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&v.push(i[r][0]),i[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);l&&l(t);while(v.length)v.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],s=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(s=!1)}s&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var s={},i={app:0},a=[];function r(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"01bb":function(e,t,n){},"034f":function(e,t,n){"use strict";n("85ec")},"1a2a":function(e,t,n){"use strict";n("01bb")},"2dff":function(e,t,n){},"452c":function(e,t,n){},4839:function(e,t,n){"use strict";n("9d9b")},"486b":function(e,t,n){},"4e57":function(e,t,n){},5417:function(e,t,n){"use strict";n("729c")},"56d7":function(e,t,n){"use strict";n.r(t);n("b0c0"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},["/server"===e.$route.path?n("Server"):e.authenticated?[n("div",[n("Sidebar"),n("Main")],1)]:n("Auth")],2)},a=[],r=n("5530"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sidebar"},[n("div",{staticClass:"user"},[n("div",{staticClass:"user-picture"},[n("img",{staticClass:"ui circular image",attrs:{src:e.user.picture_url}})]),n("div",{staticClass:"user-info"},[n("div",{staticClass:"user-info-pseudo"},[e._v(e._s(e.user.username))]),n("div",{staticClass:"user-info-status ui simple dropdown"},[n("div",{staticClass:"available text"},[e._v(" En ligne ")]),n("i",{staticClass:"dropdown icon"}),n("div",{staticClass:"menu"},[e._e(),n("div",{staticClass:"item",on:{click:e.deauthenticate}},[n("i",{staticClass:"logout icon"}),e._v(" Déconnexion ")])])])])]),n("div",{staticClass:"menu"},[n("div",{staticClass:"blue button",on:{click:e.openCommunity}},[n("i",{staticClass:"users icon"}),n("br"),n("span",[e._v("Communauté")])]),e._e()]),n("div",{staticClass:"conversations"},[n("div",{staticClass:"conversation-search"},[n("div",{staticClass:"ui fluid search"},[n("div",{staticClass:"ui icon input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"prompt",attrs:{type:"text",placeholder:"Rechercher une conversation"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}}),n("i",{staticClass:"search icon"})]),n("div",{staticClass:"results"})])]),e._l(e.filteredConversations,(function(t){return n("div",{key:t.id,staticClass:"conversation",class:{selected:t.isCurrent,new:t.isNew,available:!t.isNew&&t.isOnline},attrs:{title:t.title},on:{click:function(n){return e.openConversation(t.id)}}},[n("a",{staticClass:"avatar"},[t.isOneToOne?n("img",{attrs:{src:t.avatar}}):n("span",[n("i",{staticClass:"users icon"})])]),n("div",{staticClass:"content"},[n("div",{staticClass:"metadata"},[n("div",{staticClass:"title"},[t.isNew||t.isOnline?n("i",{staticClass:"ui small icon circle"}):e._e(),e._v(" "+e._s(t.title)+" ")]),n("span",{staticClass:"time"},[e._v(e._s(t.updated_at.toLocaleTimeString()))])]),n("div",{staticClass:"text"},[e._v(" "+e._s(t.messages.length?t.lastMessageContent:"Nouvelle conversation")+" ")])])])}))],2)])},c=[],u=(n("4de4"),n("caad"),n("ac1f"),n("2532"),n("841c"),n("8c4f")),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"community"},[n("div",{staticClass:"filter"},[n("div",{staticClass:"ui fluid search"},[n("div",{staticClass:"ui icon input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"prompt",attrs:{type:"text",placeholder:"Rechercher un utilisateur"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}}),n("i",{staticClass:"search icon"})]),n("div",{staticClass:"results"})])]),n("div",{staticClass:"users"},[e._l(e.filteredUsers,(function(t){return[t.isMe?e._e():n("div",{key:t.username,staticClass:"user",class:{selected:e.isUserSelected(t.username)},on:{click:function(n){return e.toggleUser(t.username)}}},[n("img",{attrs:{src:t.picture_url}}),n("span",{class:{available:t.isOnline}},[e._v(e._s(t.username))])])]}))],2),n("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedUsers.length,expression:"selectedUsers.length"}],staticClass:"actions",on:{click:e.openConversation}},[n("button",{staticClass:"ui primary big button"},[n("i",{staticClass:"conversation icon"}),e.opening?n("span",[e._v(" Ouverture de conversation... ")]):n("span",[e._v(" Ouvrir la conversation ("+e._s(e.selectedUsers.length)+") ")])])])])},d=[],v=(n("45fc"),n("d3b7"),n("2f62")),m={name:"Community",data:function(){return{selectedUsers:[],opening:!1,search:""}},methods:Object(r["a"])(Object(r["a"])({},Object(v["b"])(["createOneToOneConversation","createManyToManyConversation"])),{},{isUserSelected:function(e){return this.selectedUsers.some((function(t){return t===e}))},toggleUser:function(e){this.isUserSelected(e)?this.selectedUsers=this.selectedUsers.filter((function(t){return t!==e})):this.selectedUsers.push(e)},openConversation:function(){var e=this;if(!this.opening&&0!==this.selectedUsers.length){this.opening=!0;var t=1===this.selectedUsers.length?this.createOneToOneConversation(this.selectedUsers[0]):this.createManyToManyConversation(this.selectedUsers);t.finally((function(){e.opening=!1}))}}}),computed:Object(r["a"])(Object(r["a"])({},Object(v["c"])(["users"])),{},{filteredUsers:function(){var e=this;return this.users.filter((function(t){return String(t.username).toLowerCase().includes(e.search.toLowerCase())}))}})},p=m,f=(n("c062"),n("2877")),h=Object(f["a"])(p,l,d,!1,null,"0e595afa",null),g=h.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.conversation?n("div",{staticClass:"conversation"},[n("div",{staticClass:"conversation-header"},[e.conversation.isOneToOne?n("img",{staticClass:"avatar",attrs:{src:e.conversation.avatar}}):n("div",{staticClass:"avatar"},[n("i",{staticClass:"ui users icon"})]),n("div",{staticClass:"title"},[n("div",{staticClass:"ui compact"},[e.conversation.isOnline?n("i",{staticClass:"icon circle"}):e._e(),n("span",[e._v(e._s(e.conversation.title))]),n("div",{staticClass:"ui simple dropdown item"},[n("i",{staticClass:"vertical ellipsis icon"}),n("div",{staticClass:"menu"},[e._e(),e._e(),e._e(),e._e(),n("div",{staticClass:"item",on:{click:function(t){e.groupPanel=!e.groupPanel}}},[n("i",{staticClass:"ui icon users"}),e._v(" Gérer les participants ")])])])])])]),n("div",{staticClass:"conversation-container"},[n("div",{staticClass:"conversation-main"},[n("div",{staticClass:"conversation-body",attrs:{id:"scroll"}},[n("div",{staticClass:"wrapper"},[e._l(e.conversation.elements,(function(t,s){return["time"===t.type?n("div",{key:s,staticClass:"time"},[e._v(" "+e._s(t.time.toLocaleTimeString())+" ")]):"bubble"===t.type?n("div",{key:s,staticClass:"message",class:{mine:t.mine,transiting:t.transiting}},[t.bottom&&!t.mine?n("img",{attrs:{title:t.username,src:t.picture_url}}):e._e(),n("div",{staticClass:"bubble",class:{top:t.top,middle:t.middle,bottom:t.bottom}},[t.reply?n("p",{staticClass:"reply_content"},[e._v(" "+e._s(t.reply)+" ")]):e._e(),e._v(" "+e._s(t.content)+" ")]),n("div",{staticClass:"reacts"},["HEART"in t.reactions?n("i",{staticClass:"circular heart outline icon",attrs:{title:"Aimer"}},[e._v(e._s(t.reactions.HEART))]):e._e(),"THUMB"in t.reactions?n("i",{staticClass:"circular thumbs up outline icon",attrs:{title:"Pouce en l'air"}},[e._v(e._s(t.reactions.THUMB))]):e._e(),"HAPPY"in t.reactions?n("i",{staticClass:"circular smile outline icon",attrs:{title:"Content"}},[e._v(e._s(t.reactions.HAPPY))]):e._e(),"SAD"in t.reactions?n("i",{staticClass:"circular frown outline icon",attrs:{title:"Pas content"}},[e._v(e._s(t.reactions.SAD))]):e._e()]),t.mine?n("div",{staticClass:"controls"},[n("i",{staticClass:"circular trash icon",attrs:{title:"Supprimer"},on:{click:function(n){return e.remove(t.id)}}}),n("i",{staticClass:"circular edit icon",attrs:{title:"Editer"},on:{click:function(n){return e.edit(t.id,t.content)}}}),n("i",{staticClass:"circular reply icon",attrs:{title:"Répondre"},on:{click:function(n){return e.reply(t.username,t.id,t.content)}}})]):n("div",{staticClass:"controls"},[n("i",{staticClass:"circular reply icon",attrs:{title:"Répondre"},on:{click:function(n){return e.reply(t.username,t.id,t.content)}}}),n("span",{staticClass:"react"},[n("i",{staticClass:"circular heart outline icon",attrs:{title:"Aimer"},on:{click:function(n){return e.react(t.id,"HEART")}}}),n("i",{staticClass:"circular thumbs up outline icon",attrs:{title:"Pouce en l'air"},on:{click:function(n){return e.react(t.id,"THUMB")}}}),n("i",{staticClass:"circular smile outline icon",attrs:{title:"Content"},on:{click:function(n){return e.react(t.id,"HAPPY")}}}),n("i",{staticClass:"circular frown outline icon",attrs:{title:"Pas content"},on:{click:function(n){return e.react(t.id,"SAD")}}})])])]):"views"===t.type?n("div",{key:s,staticClass:"view"},e._l(t.views,(function(e,t){return n("img",{key:t,attrs:{title:"Vu par "+t+" à "+e.time.toLocaleTimeString(),src:e.picture_url}})})),0):e._e()]}))],2)]),e._e(),n("div",{staticClass:"conversation-footer"},[n("div",{staticClass:"wrapper"},["post"!==e.mode?n("p",[n("i",{staticClass:"circular times small icon link",attrs:{title:"Abandonner"},on:{click:e.abort}}),"reply"===e.mode?[e._v(" Répondre à "+e._s(e.replyTo)+" : "),n("span",[e._v(" "+e._s(e.replyAbout)+" ")])]:e._e(),"edit"===e.mode?[e._v(" Edition ")]:e._e()],2):e._e(),n("div",{staticClass:"ui fluid search"},[n("div",{staticClass:"ui icon input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],staticClass:"prompt",attrs:{type:"text",placeholder:"Rédiger un message"},domProps:{value:e.content},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)},input:function(t){t.target.composing||(e.content=t.target.value)}}}),n("i",{staticClass:"send icon"})])])])])]),e.groupPanel?n("div",{staticClass:"conversation-sidebar"},[n("Group")],1):e._e()])]):e._e()},_=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"group"},[e.addable?n("div",{staticClass:"ui fluid search"},[n("div",{staticClass:"ui icon input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"prompt",attrs:{type:"text",placeholder:"Rechercher un utilisateur"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}}),n("i",{staticClass:"search icon"})])]):e._e(),e._m(0),e._l(e.participants,(function(t){return n("div",{key:t.username,staticClass:"user"},[n("img",{attrs:{src:t.picture_url}}),n("span",[e._v(e._s(t.username)),n("br"),n("i",{staticClass:"nickname"},[e._v(e._s(t.nickname))])]),n("i",{staticClass:"circular quote left link icon",attrs:{title:"Modifier le surnom"}}),n("i",{directives:[{name:"show",rawName:"v-show",value:e.removable,expression:"removable"}],staticClass:"circular times icon link",attrs:{title:"Enlever de la conversation"},on:{click:function(n){return e.removeFromGroup(t.username)}}})])})),e.addable?[e.community.length?n("div",{staticClass:"spanner"},[n("hr"),n("span",[e._v("Communauté")]),n("hr")]):e._e(),e._l(e.community,(function(t){return n("div",{key:t.username,staticClass:"user"},[n("img",{attrs:{src:t.picture_url}}),n("span",[e._v(e._s(t.username))]),n("i",{staticClass:"circular plus icon link",attrs:{title:"Ajouter à la conversation"},on:{click:function(n){return e.addToGroup(t.username)}}})])}))]:e._e()],2)},y=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spanner"},[n("hr"),n("span",[e._v("Participants")]),n("hr")])}],O=(n("d81d"),{name:"Group",data:function(){return{search:""}},computed:Object(r["a"])(Object(r["a"])({},Object(v["c"])(["conversation","users","user"])),{},{participants:function(){var e=this;return this.users.filter((function(t){return e.conversation.participants.includes(t.username)})).map((function(t){return Object(r["a"])(Object(r["a"])({},t),{},{nickname:e.conversation[t.username]})})).filter((function(t){return String(t.username).toLowerCase().includes(e.search.toLowerCase())}))},removable:function(){return this.participants.length>3},addable:function(){return this.participants.length>2},community:function(){var e=this;return this.users.filter((function(t){return!e.conversation.participants.includes(t.username)})).filter((function(t){return String(t.username).toLowerCase().includes(e.search.toLowerCase())}))}}),methods:Object(r["a"])(Object(r["a"])({},Object(v["b"])(["addParticipant","removeParticipant"])),{},{addToGroup:function(e){this.addParticipant({conversation_id:this.conversation.id,username:e})},removeFromGroup:function(e){this.removeParticipant({conversation_id:this.conversation.id,username:e}),e===this.user.username&&q.push({name:"Community"})}})}),w=O,j=(n("1a2a"),Object(f["a"])(w,b,y,!1,null,"3124e249",null)),k=j.exports,M={name:"Conversation",components:{Group:k},data:function(){return{replyAt:null,replyAbout:null,editId:null,mode:"post",content:"",groupPanel:!1}},mounted:function(){this.scrollBottom(),this.seeConversation(this.conversation.id)},updated:function(){this.scrollBottom()},computed:Object(r["a"])({},Object(v["c"])(["conversation"])),methods:Object(r["a"])(Object(r["a"])({},Object(v["b"])(["postMessage","seeConversation","reactMessage","editMessage","replyMessage","deleteMessage"])),{},{sendMessage:function(){this.content.length&&("edit"===this.mode?this.editMessage({conversation_id:this.conversation.id,message_id:this.editId,content:this.content}):"reply"===this.mode?this.replyMessage({conversation_id:this.conversation.id,message_id:this.replyAt,content:this.content}):this.postMessage(this.content),this.abort())},scrollBottom:function(){setTimeout((function(){document.querySelector("#scroll").scrollTop=document.querySelector("#scroll").scrollHeight}),0)},react:function(e,t){this.reactMessage({conversation_id:this.conversation.id,message_id:e,reaction:t})},reply:function(e,t,n){this.mode="reply",this.replyTo=e,this.replyAt=t,this.replyAbout=n},edit:function(e,t){this.mode="edit",this.editId=e,this.content=t},remove:function(e){this.deleteMessage({conversation_id:this.conversation.id,message_id:e})},abort:function(){this.replyAt=null,this.replyAbout=null,this.editId=null,this.mode="post",this.content=""}}),watch:{conversation:function(e,t){var n,s;this.scrollBottom(),(null===e||void 0===e||null===(n=e.lastValidMessage)||void 0===n?void 0:n.id)!==(null===t||void 0===t||null===(s=t.lastValidMessage)||void 0===s?void 0:s.id)&&this.seeConversation(this.conversation.id)}}},x=M,S=(n("5417"),Object(f["a"])(x,C,_,!1,null,"365238e6",null)),A=S.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search-message"},[e._m(0),n("div",{staticClass:"conversations"},e._l(10,(function(t){return n("div",{key:t,staticClass:"conversation"},[n("div",{staticClass:"author"},[t%2?[n("img",{attrs:{src:"https://source.unsplash.com/7YVZYZeITc8/100x100"}}),n("span",[e._v("Bob")])]:[n("div",{staticClass:"avatar"},[e._v("M")]),n("span",[e._v("Groupe : METINET")])]],2),e._l(3,(function(t){return n("div",{key:t,staticClass:"messages"},[e._m(1,!0)])}))],2)})),0)])},P=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"filter"},[n("div",{staticClass:"ui fluid search"},[n("div",{staticClass:"ui icon input"},[n("input",{staticClass:"prompt",attrs:{type:"text",placeholder:"Rechercher un message"}}),n("i",{staticClass:"search icon"})]),n("div",{staticClass:"results"})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"message"},[n("div",{staticClass:"time"},[e._v("14/07/2020 13:37")]),n("div",{staticClass:"bubble"},[e._v(" Blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah ")])])}],T={name:"Search"},R=T,E=(n("5af1"),Object(f["a"])(R,I,P,!1,null,"d1ff53f8",null)),N=E.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{margin:"50px auto",width:"400px"}},[n("div",{staticClass:"ui middle aligned center aligned grid"},[n("div",{staticClass:"column"},[e._m(0),n("form",{staticClass:"ui large form"},[n("div",{staticClass:"ui attached segment"},[n("div",{staticClass:"field"},[n("div",{staticClass:"ui left icon input"},[n("i",{staticClass:"server icon"}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.endpoint,expression:"endpoint"}],attrs:{type:"text",name:"server",placeholder:"Endpoint"},domProps:{value:e.endpoint},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.updateServer(t)},input:function(t){t.target.composing||(e.endpoint=t.target.value)}}})])]),n("div",{staticClass:"ui fluid large primary submit button",on:{click:e.updateServer}},[e._v(" Enregistrer ")])])])])])])},$=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h2",{staticClass:"ui primary image header"},[n("div",{staticClass:"content"},[e._v(" Configuration ")])])}],V={name:"Server",data:function(){return{endpoint:localStorage.getItem("server")||"wss://teach-vue-chat-server.glitch.me"}},methods:{updateServer:function(){localStorage.setItem("server",this.endpoint),window.location.href="/"}}},D=V,L=Object(f["a"])(D,U,$,!1,null,"7bde5c45",null),G=L.exports;s["a"].use(u["a"]);var H=[{path:"/",name:"Community",component:g},{path:"/conversation/:id",name:"Conversation",component:A},{path:"/search",name:"Search",component:N},{path:"/server",name:"Server",component:G}],B=new u["a"]({routes:H}),Y=B.push;B.push=function(e){return Y.call(this,e).catch((function(e){return e}))};var q=B,z={name:"Sidebar",data:function(){return{search:""}},methods:Object(r["a"])(Object(r["a"])({},Object(v["b"])(["deauthenticate"])),{},{openCommunity:function(){q.push({name:"Community"})},openMessageSearch:function(){q.push({name:"Search"})},openConversation:function(e){q.push({name:"Conversation",params:{id:e}})}}),computed:Object(r["a"])(Object(r["a"])({},Object(v["c"])(["user","conversations"])),{},{filteredConversations:function(){var e=this;return this.conversations.filter((function(t){return String(t.title).toLowerCase().includes(e.search.toLowerCase())}))}})},F=z,J=(n("bb2c"),Object(f["a"])(F,o,c,!1,null,"73baddaf",null)),Z=J.exports,K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"},[n("router-view")],1)},Q=[],W={name:"Main"},X=W,ee=(n("4839"),Object(f["a"])(X,K,Q,!1,null,"27c7f8be",null)),te=ee.exports,ne=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"auth"},[n("div",{staticClass:"ui middle aligned center aligned grid"},[n("div",{staticClass:"column"},[e._m(0),n("form",{staticClass:"ui large form"},[e.authenticating?n("div",{staticClass:"ui attached segment"},[n("div",[e._v("Authentification...")]),n("i",[n("router-link",{attrs:{to:"/server"}},[e._v(e._s(e.endpoint))])],1)]):n("div",[n("div",{staticClass:"ui attached segment"},[n("div",{staticClass:"field"},[n("div",{staticClass:"ui left icon input"},[n("i",{staticClass:"user icon"}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"pseudo",placeholder:"Nom d'utilisateur"},domProps:{value:e.username},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)},input:function(t){t.target.composing||(e.username=t.target.value)}}})])]),n("div",{staticClass:"field"},[n("div",{staticClass:"ui left icon input"},[n("i",{staticClass:"lock icon"}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Mot de passe"},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)},input:function(t){t.target.composing||(e.password=t.target.value)}}})])]),n("div",{staticClass:"ui fluid large primary submit button",on:{click:e.login}},[e._v(" Connexion ")])]),n("div",{staticClass:"ui attached segment"},[e._v(" La première connexion créer un compte. ")]),n("div",{staticClass:"ui bottom attached segment"},[n("router-link",{attrs:{to:"/server"}},[e._v("Configuration du serveur")])],1),n("div",{staticClass:"ui error message"})])])])])])},se=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h2",{staticClass:"ui primary image header"},[n("div",{staticClass:"content"},[e._v(" #Teach Vue chat client ")])])}],ie={name:"Auth",data:function(){return{endpoint:localStorage.getItem("server")||"wss://teach-vue-chat-server.glitch.me",username:localStorage.getItem("username")||"",password:""}},computed:Object(r["a"])({},Object(v["c"])(["authenticating"])),methods:Object(r["a"])(Object(r["a"])({},Object(v["b"])(["authenticate"])),{},{login:function(){this.authenticate({username:this.username,password:this.password})}})},ae=ie,re=(n("98f1"),Object(f["a"])(ae,ne,se,!1,null,"5b32bb9b",null)),oe=re.exports,ce={components:{Auth:oe,Sidebar:Z,Main:te,Server:G},mounted:function(){},computed:Object(r["a"])({},Object(v["c"])(["authenticated"]))},ue=ce,le=(n("034f"),n("b0a0"),Object(f["a"])(ue,i,a,!1,null,null,null)),de=le.exports,ve=(n("7db0"),n("c740"),n("4160"),n("a15b"),n("b64b"),n("159b"),n("ade3")),me=n("b85c");s["a"].use(v["a"]);var pe=new v["a"].Store({state:{authenticating:!1,currentConversationId:null,user:{username:null,token:null,picture_url:null},users:[],conversations:[],usersAvailable:[]},getters:{authenticating:function(e){return e.authenticating},authenticated:function(e){return null!==e.user.token},user:function(e){return e.user},users:function(e){return e.users.map((function(t){return Object(r["a"])(Object(r["a"])({},t),{},{last_activity_at:new Date(t.last_activity_at),isMe:t.username===e.user.username,isOnline:e.usersAvailable.includes(t.username)})}))},conversations:function(e){return e.conversations.map((function(t){var n,s=t.messages.length?t.messages[t.messages.length-1]:null,i=null,a=Object(me["a"])(t.messages);try{for(a.s();!(n=a.n()).done;){var o=n.value;null!==o.id&&(i=o)}}catch(f){a.e(f)}finally{a.f()}var c=t.id===e.currentConversationId,u=!0;e.user.username in t.seen&&(u=null!==i&&t.seen[e.user.username].message_id<i.id);var l=t.title,d="one_to_one"===t.type,v=t.participants.filter((function(t){return t!==e.user.username})),m=v.some((function(t){return e.usersAvailable.includes(t)})),p="?";return d?p=e.users.find((function(e){return e.username===v[0]})).picture_url:l&&(p=l[0]),l||(l=v.join(", "),d||(l="Groupe: "+l)),Object(r["a"])(Object(r["a"])({},t),{},{title:l,isCurrent:c,isOneToOne:d,isOnline:m,isNew:u,avatar:p,messages:t.messages.map((function(t){return Object(r["a"])(Object(r["a"])({},t),{},{isMine:t.from===e.user.username,posted_at:new Date(t.posted_at)})})),lastValidMessage:i,updated_at:new Date(t.updated_at),lastMessageContent:null===s||void 0===s?void 0:s.content})}))},conversation:function(e,t){var n=[],s=t.conversations.find((function(t){return t.id===e.currentConversationId}));return s?(s.messages.forEach((function(t,i){for(var a,r=i>0?s.messages[i-1]:null,o=i+1<s.messages.length?s.messages[i+1]:null,c={},u=function(){var n=d[l];s.seen[n].message_id===t.id&&(c[n]={picture_url:e.users.find((function(e){return e.username===n})).picture_url,time:new Date(s.seen[n].time)})},l=0,d=Object.keys(s.seen);l<d.length;l++)u();null!==r&&r.isMine===t.isMine||n.push({type:"time",time:t.posted_at});for(var v=null===r||t.from!==r.from,m=null===o||t.from!==o.from,p=!v&&!m,f={},h=0,g=Object.keys(t.reactions);h<g.length;h++){var C=g[h],_=t.reactions[C];f[_]=_ in f?f[_]+1:1}n.push({type:"bubble",id:t.id,reactions:f,transiting:null===t.id,mine:t.isMine,content:t.content,reply:null===(a=t.reply_to)||void 0===a?void 0:a.content,username:t.from,picture_url:e.users.find((function(e){return e.username===t.from})).picture_url,top:v,middle:p,bottom:m}),Object.keys(c).length&&n.push({type:"views",views:c})})),Object(r["a"])(Object(r["a"])({},s),{},{elements:n})):null}},mutations:{setUsersAvailable:function(e,t){var n=t.usernames;e.usersAvailable=n},syncCurrentConversation:function(e,t){e.currentConversationId=t},setAuthenticating:function(e,t){e.authenticating=t},setUser:function(e,t){var n=t.username,i=t.token,a=t.picture_url;s["a"].set(e.user,"username",n),s["a"].set(e.user,"token",i),s["a"].set(e.user,"picture_url",a)},setUsers:function(e,t){e.users=t},upsertUser:function(e,t){var n=t.user,i=e.users.findIndex((function(e){return e.username===n.username}));-1!==i?s["a"].set(e.users,i,n):e.users.push(Object(r["a"])({},n))},upsertConversation:function(e,t){var n=t.conversation,i=e.conversations.findIndex((function(e){return e.id===n.id}));-1!==i?s["a"].set(e.conversations,i,n):e.conversations.push(Object(r["a"])({},n)),e.conversations=e.conversations.filter((function(t){return t.participants.includes(e.user.username)}))},upsertMessage:function(e,t){var n=t.conversation_id,i=t.message,a=e.conversations.find((function(e){return e.id===n}));if(a){var o=a.messages.findIndex((function(e){return e.id===i.id}));-1!==o&&null!==i.id?s["a"].set(a.messages,o,i):a.messages.push(Object(r["a"])({},i))}},cleanMessage:function(e,t){var n=t.conversation_id,i=t.transit,a=e.conversations.find((function(e){return e.id===n}));a&&s["a"].set(a,"messages",a.messages.filter((function(e){return(null===e||void 0===e?void 0:e.transit)!==i})))},setConversations:function(e,t){e.conversations=t},deleteMessage:function(e,t){var n=t.conversation_id,i=t.message_id,a=e.conversations.find((function(e){return e.id===n}));if(a){var r=a.messages.findIndex((function(e){return e.id===i}));-1!==r&&null!==i&&s["a"].delete(a.messages,r)}}},actions:{authenticate:function(e,t){var n=e.commit,i=e.dispatch,a=t.username,r=t.password;a&&r&&(n("setAuthenticating",!0),s["a"].prototype.$client.authenticate(a,r).then((function(e){n("setUser",e),localStorage.setItem("username",a),localStorage.setItem("password",r),i("initializeAfterAuthentication")})).catch((function(){alert("Erreur d'authentification !")})).finally((function(){n("setAuthenticating",!1)})))},deauthenticate:function(){localStorage.removeItem("password"),window.location.reload()},initializeAfterAuthentication:function(e){var t=e.dispatch;t("fetchUsers"),t("fetchConversations")},fetchUsers:function(e){var t=e.commit;s["a"].prototype.$client.getUsers().then((function(e){var n=e.users;t("setUsers",n)}))},fetchConversations:function(e){var t=e.commit;s["a"].prototype.$client.getConversations().then((function(e){var n=e.conversations;t("setConversations",n.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{updated_at:e.updated_at})})))}))},createOneToOneConversation:function(e,t){var n=e.commit,i=s["a"].prototype.$client.getOrCreateOneToOneConversation(t);return i.then((function(e){var t=e.conversation;n("upsertConversation",{conversation:t}),q.push({name:"Conversation",params:{id:t.id}})})),i},createManyToManyConversation:function(e,t){var n=e.commit,i=s["a"].prototype.$client.createManyToManyConversation(t);return i.then((function(e){var t=e.conversation;n("upsertConversation",{conversation:t}),q.push({name:"Conversation",params:{id:t.id}})})),i},postMessage:function(e,t){var n=e.state,i=e.commit;if(null===n.currentConversationId)return Promise.reject();var a=s["a"].prototype.$client.postMessage(n.currentConversationId,t),r=(new Date).toISOString(),o=Math.random();return i("upsertMessage",{conversation_id:n.currentConversationId,message:{id:null,from:n.user.username,content:t,posted_at:r,delivered_to:Object(ve["a"])({},n.user.username,r),seen_by:Object(ve["a"])({},n.user.username,r),reply_to:null,edited:!1,deleted:!1,reactions:{},transit:o}}),a.then((function(e){var t=e.message;i("upsertMessage",{conversation_id:n.currentConversationId,message:t})})).finally((function(){i("cleanMessage",{conversation_id:n.currentConversationId,transit:o})})),a},seeConversation:function(e,t){var n=e.getters,i=n.conversations.find((function(e){return e.id===t}));return i?i.lastValidMessage?s["a"].prototype.$client.seeConversation(i.id,i.lastValidMessage.id):Promise.resolve(null):Promise.reject("NOT_VALID_CONVERSATION_ID")},reactMessage:function(e,t){var n=e.getters,i=t.conversation_id,a=t.message_id,r=t.reaction,o=n.conversations.find((function(e){return e.id===i}));return o?o.lastValidMessage?s["a"].prototype.$client.reactMessage(o.id,a,r):Promise.resolve(null):Promise.reject("NOT_VALID_CONVERSATION_ID")},editMessage:function(e,t){var n=e.getters,i=t.conversation_id,a=t.message_id,r=t.content,o=n.conversations.find((function(e){return e.id===i}));return o?o.lastValidMessage?s["a"].prototype.$client.editMessage(o.id,a,r):Promise.resolve(null):Promise.reject("NOT_VALID_CONVERSATION_ID")},replyMessage:function(e,t){var n=e.getters,i=t.conversation_id,a=t.message_id,r=t.content,o=n.conversations.find((function(e){return e.id===i}));return o?o.lastValidMessage?s["a"].prototype.$client.replyMessage(o.id,a,r):Promise.resolve(null):Promise.reject("NOT_VALID_CONVERSATION_ID")},deleteMessage:function(e,t){var n=e.getters,i=t.conversation_id,a=t.message_id,r=n.conversations.find((function(e){return e.id===i}));return r?r.lastValidMessage?s["a"].prototype.$client.deleteMessage(r.id,a):Promise.resolve(null):Promise.reject("NOT_VALID_CONVERSATION_ID")},addParticipant:function(e,t){var n=e.getters,i=t.conversation_id,a=t.username,r=n.conversations.find((function(e){return e.id===i}));return r?s["a"].prototype.$client.addParticipant(r.id,a):Promise.reject("NOT_VALID_CONVERSATION_ID")},removeParticipant:function(e,t){var n=e.getters,i=t.conversation_id,a=t.username,r=n.conversations.find((function(e){return e.id===i}));return r?s["a"].prototype.$client.removeParticipant(r.id,a):Promise.reject("NOT_VALID_CONVERSATION_ID")}},modules:{}}),fe=(n("96cf"),n("1da1")),he=n("8a76"),ge=localStorage.getItem("server")||"wss://teach-vue-chat-server.glitch.me",Ce=new he["a"](ge);function _e(e,t){e.prototype.$client=Ce;var n=localStorage.getItem("username"),s=localStorage.getItem("password");n&&s&&t.dispatch("authenticate",{username:n,password:s}),Ce.on("conversationCreated",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation,t.commit("upsertConversation",{conversation:s});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("participantAdded",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation,t.commit("upsertConversation",{conversation:s});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("participantRemoved",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation,t.commit("upsertConversation",{conversation:s});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("userCreated",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.user,t.commit("upsertUser",{user:s});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("messagePosted",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation_id,i=n.message,t.commit("upsertMessage",{conversation_id:s,message:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("messageDelivered",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation_id,i=n.message,t.commit("upsertMessage",{conversation_id:s,message:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("conversationSeen",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation,t.commit("upsertConversation",{conversation:s});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("messageReacted",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation_id,i=n.message,t.commit("upsertMessage",{conversation_id:s,message:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("messageEdited",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation_id,i=n.message,t.commit("upsertMessage",{conversation_id:s,message:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("messageDeleted",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.conversation_id,i=n.message_id,t.commit("deleteMessage",{conversation_id:s,message_id:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ce.on("usersAvailable",function(){var e=Object(fe["a"])(regeneratorRuntime.mark((function e(n){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=n.usernames,t.commit("setUsersAvailable",{usernames:s});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}s["a"].config.productionTip=!1,q.beforeEach((function(e,t,n){pe.commit("syncCurrentConversation","Conversation"===e.name?e.params.id:null),n()})),new s["a"]({router:q,store:pe,render:function(e){return e(de)}}).$mount("#app"),q.push({name:"Community"}),s["a"].use(_e,pe)},"5af1":function(e,t,n){"use strict";n("4e57")},"729c":function(e,t,n){},"85ec":function(e,t,n){},"98f1":function(e,t,n){"use strict";n("2dff")},"9d9b":function(e,t,n){},b0a0:function(e,t,n){"use strict";n("452c")},bb2c:function(e,t,n){"use strict";n("fddc")},c062:function(e,t,n){"use strict";n("486b")},fddc:function(e,t,n){}});
//# sourceMappingURL=app.acec75f7.js.map